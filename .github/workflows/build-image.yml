name: Home task 2'

on: [push]

jobs:
    test:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v4
            
            - name: Setup dotnet 7.0
              uses: actions/setup-dotnet@v3
              with:
                dotnet-version: '7.0.x'

            - name: Display dotnet version
              run: dotnet --version
            
            - name: Install requipments
              run: dotnet restore
            - name: Build
              run: dotnet build
            - name: Test with the dotnet CLI
              run: dotnet test
    docker:
        name: Docker image puch to DockerHub
        runs-on: ubuntu-latest

        steps:
            - name: Check out the repo
              uses: actions/checkout@v4

            - name: Log in to Docker Hub
              uses: docker/login-action@v3
              with:
                username: ${{ secrets.DOCKER_USERNAME }}
                password: ${{ secrets.DOCKER_TOKEN }}
            
            - name: Build and push docker image
              uses: docker/build-push-action@v2
              with:
                context: .
                push: true
                tags: ci_cd_docker/productservice:latest
